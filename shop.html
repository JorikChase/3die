<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - multiple elements</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <link rel="icon" type="image/x-icon" href="/3die.ico" />
    <link type="text/css" rel="stylesheet" href="/IORI/assets/main.css" />
    <link type="text/css" rel="stylesheet" href="/IORI/assets/burger.css" />
    <style>
      * {
        box-sizing: border-box;
        -moz-box-sizing: border-box;
      }

      body {
        background-color: #d6b454;
        color: #8d007a;
      }

      a {
        text-decoration: none;
        font-size: 1.5em;
        text-align: right;
        color: rgb(251, 251, 0);
        transition: color 1s ease-in-out;
      }
      a:hover {
        color: rgb(255, 255, 255);
      }

      #content {
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1;
        padding: 10em 0 0 2em;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      #c {
        position: absolute;
        left: 0;
        width: 100%;
        height: 100%;
        -webkit-transition-property: none;
        -moz-transition-property: none;
        -o-transition-property: none;
        transition-property: none;
      }

      .list-item {
        display: inline-block;
        margin: 1em;
        padding: 1em;
        box-shadow: 1px 2px 4px 0px rgba(0, 0, 0, 0.25);
      }

      .list-item > div:nth-child(1) {
        width: 25vw;
        height: 25vw;
        transition: width 1s ease-in-out, height 1s ease-in-out;
      }
      .list-item > div:nth-child(2) {
        color: #888;
        font-size: small;
        margin-top: 0.5em;
        transition: width 1s ease-in-out, height 1s ease-in-out;
        text-align: center;
      }
      @media screen and (max-width: 992px) {
        .list-item > div:nth-child(1) {
          width: 70vw;
          height: 70vw;
        }
      }
    </style>
  </head>
  <body>
    
    <canvas id="c"></canvas>

    <div id="content"></div>

    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script
      async
      src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
    ></script>

    <script type="importmap">
      {
        "imports": {
          "three": "https://threejs.org/build/three.module.js",
          "three/addons/": "https://threejs.org/examples/jsm/"
        }
      }
    </script>

    <script type="module">
      import * as THREE from "three";
      import { MTLLoader } from "three/addons/loaders/MTLLoader.js";
      import { OBJLoader } from "three/addons/loaders/OBJLoader.js";
      import { OrbitControls } from "three/addons/controls/OrbitControls.js";
      import { RGBELoader } from "three/addons/loaders/RGBELoader.js";

      let canvas, renderer, scene, object, material;

      const scenes = [];

      init();
      animate();

      function init() {
        canvas = document.getElementById("c");

        const geometries = [
          ,
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
          new THREE.PlaneGeometry(1.5, 1.5),
        ];
        const textures = [
          ,
          "balkon1.jpg",
          "balkon2.jpg",
          "crazy5.jpg",
          "void.jpg",
          "geoCube.jpg",
        ];

        const linkNames = [
          "Buy Yachym",
          "Balkon A",
          "Balkon B",
          "Stairs",
          "Void A",
          "Geocube",
          "Mushroom land",
          "Buy Yachym",
          "Buy Yachym",
          "Buy Yachym",
        ];

        const linkLinks = [
          "https://buy.stripe.com/3cs15bdbkdhk8Bq6op",
          "./shop/BalkonA.html",
          "./shop/BalkonB.html",
          "./shop/Stairs.html",
          "./shop/Void.html",
          "./shop/Geocube.html",
          "./shop/Svet.html",
          "./shop/BalkonB.html https://buy.stripe.com/3cs15bdbkdhk8Bq6op",
          "./shop/BalkonB.html https://buy.stripe.com/3cs15bdbkdhk8Bq6op",
          "./shop/BalkonB.html https://buy.stripe.com/3cs15bdbkdhk8Bq6op",
        ];

        const objectFile = ["JBK_balls.obj"];

        const materialFile = ["JBK_balls.mtl"];
        const materialBase = [
          "/IORI/assets/textures/shopTextures/base.png",
          "JBK_balls.mtl",
        ];
        const materialRoughness = [
          "/IORI/assets/textures/shopTextures/roughness.png",
          "JBK_balls.mtl",
        ];
        const materialBump = [
          "/IORI/assets/textures/shopTextures/bump.png",
          "JBK_balls.mtl",
        ];

        const content = document.getElementById("content");

        for (let i = 0; i < 8; i++) {
          const scene = new THREE.Scene();

          // make a list item
          const element = document.createElement("div");
          element.className = "list-item";

          const sceneElement = document.createElement("div");
          element.appendChild(sceneElement);

          const descriptionElement = document.createElement("div");
          const descriptionAElement = document.createElement("a");
          descriptionAElement.innerText = linkNames[0 + i];
          descriptionAElement.setAttribute("href", linkLinks[0 + i]);
          descriptionElement.appendChild(descriptionAElement);
          element.appendChild(descriptionElement);

          // the element that represents the area we want to render the scene
          scene.userData.element = sceneElement;
          content.appendChild(element);

          const camera = new THREE.PerspectiveCamera(50, 1, 1, 10);
          camera.position.z = 3;
          scene.userData.camera = camera;

          const controls = new OrbitControls(
            scene.userData.camera,
            scene.userData.element
          );
          controls.minDistance = 2;
          controls.maxDistance = 5;
          controls.enablePan = false;
          controls.enableZoom = false;
          scene.userData.controls = controls;
          // hdri

          new RGBELoader()
            .setPath("/3die/IORI/assets/textures/")
            .load("outer-space-background-small.hdr", function (texture) {
              texture.mapping = THREE.EquirectangularReflectionMapping;

              scene.environment = texture;
            });

          const onProgress = function (xhr) {
            if (xhr.lengthComputable) {
              const percentComplete = (xhr.loaded / xhr.total) * 100;
              console.log(Math.round(percentComplete, 2) + "% downloaded");
            }
          };

          if (typeof objectFile[0 + i] == "string") {
            const mapHeight = new THREE.TextureLoader().load(
              materialBump[0 + i]
            );
            const mapRoughness = new THREE.TextureLoader().load(
              materialRoughness[0 + i]
            );
            const mapBase = new THREE.TextureLoader().load(materialBase[0 + i]);
            new OBJLoader()
              .setPath("/3die/IORI/assets/objects/2market/")
              .load(objectFile[0 + i], function (object) {
                object.traverse(function (child) {
                  if (child instanceof THREE.Mesh) {
                    child.material = new THREE.MeshPhysicalMaterial({
                      specularColorMap: mapBase,
                      sheenColorMap: mapBase,
                      bumpMap: mapHeight,
                      bumpScale: 0.0005,
                      roughnessMap: mapRoughness,
                      map: mapBase,
                    });
                  }
                  scene.add(object);
                  object.scale.set(0.7, 0.7, 0.7);
                }, onProgress);
              });
          }
          // add one random mesh to each scene
          const geometry = geometries[(0 + i) | 0];

          const backgroundTexture = new THREE.TextureLoader().load(
            "/3die/IORI/assets/textures/shopTextures/" + textures[0 + i]
          );

          const material = new THREE.MeshStandardMaterial({
            map: backgroundTexture,
            emissiveMap: backgroundTexture,
            emissive: 0xffffff,
            side: THREE.DoubleSide,
          });

          const light = new THREE.PointLight(0xffffff, 1, 100);
          light.position.set(50, 50, 50);
          scene.add(light);

          scene.add(new THREE.Mesh(geometry, material));

          scenes.push(scene);
        }

        renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setClearColor(0x000000, 1);
        renderer.setPixelRatio(window.devicePixelRatio);
      }

      function updateSize() {
        const width = canvas.clientWidth;
        const height = canvas.clientHeight;

        if (canvas.width !== width || canvas.height !== height) {
          renderer.setSize(width, height, false);
        }
      }

      function animate() {
        render();
        requestAnimationFrame(animate);
      }

      function render() {
        updateSize();

        canvas.style.transform = `translateY(${window.scrollY}px)`;

        renderer.setClearColor(0x000000);
        renderer.setScissorTest(false);
        renderer.clear();

        renderer.setClearColor(0x000000);
        renderer.setScissorTest(true);

        scenes.forEach(function (scene) {
          // so something moves
          scene.rotation.y = Date.now() * 0.0005;

          // get the element that is a place holder for where we want to
          // draw the scene
          const element = scene.userData.element;

          // get its position relative to the page's viewport
          const rect = element.getBoundingClientRect();

          // check if it's offscreen. If so skip it
          if (
            rect.bottom < 0 ||
            rect.top > renderer.domElement.clientHeight ||
            rect.right < 0 ||
            rect.left > renderer.domElement.clientWidth
          ) {
            return; // it's off screen
          }

          // set the viewport
          const width = rect.right - rect.left;
          const height = rect.bottom - rect.top;
          const left = rect.left;
          const bottom = renderer.domElement.clientHeight - rect.bottom;

          renderer.setViewport(left, bottom, width, height);
          renderer.setScissor(left, bottom, width, height);

          const camera = scene.userData.camera;

          //camera.aspect = width / height; // not changing in this example
          //camera.updateProjectionMatrix();

          //scene.userData.controls.update();

          renderer.render(scene, camera);
        });
      }
    </script>
        <nav class="menu--bottom--right" role="navigation">
          <div class="menuToggle">
            <input type="checkbox" />
            <span></span>
            <span></span>
            <span></span>
            <ul class="menuItem">
              <li><a href="./portfolio.html">portfolio</a></li>
              <li><a href="./shop.html">shop</a></li>
              <li><a href="./info.html">info</a></li>
            </ul>
          </div>
        </nav>
  </body>
</html>
